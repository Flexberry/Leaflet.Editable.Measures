<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8 />
<title>Leaflet.Editable based measure tools</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

<style>
  body { margin:0; padding:0; }
  #map { height: 400px; width:100%; }
  #tooltip {
    display: none;
    opacity: 0.5;
    padding: 10px;
    border: 1px dashed #999;
    font-family: sans-serif;
    font-size: 12px;
    height: 20px;
    line-height: 20px;
    z-index: 1000;
    }
</style>
<link rel="stylesheet" href="../../vendor//leaflet_1_0_0_rc2/leaflet.css" />
<script src="../../vendor/leaflet_1_0_0_rc2/leaflet-src.js"></script>
<script src="../../vendor/Leaflet.Editable/src/Leaflet.Editable.js"></script>

<script src="../../leaflet_measure.js"></script>
</head>
<body>
<div id='map'></div>

<script>
var centerPoint = [58.0060984592271,56.2445307230809];
// Create leaflet map.
var map = L.map('map', {editable: true}).setView(centerPoint, 12);

// Add OSM layer.
L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

// Add layer group for user's measurements.
var measurementsLayerGroup = L.layerGroup().addTo(map);

// Create custom measere tools instances.
var markerTool = L.Measure.marker(map, { layerGroup: measurementsLayerGroup });
var circleTool = L.Measure.circle(map, { layerGroup: measurementsLayerGroup });
var rectangleTool = L.Measure.rectangle(map, { layerGroup: measurementsLayerGroup });
var polylineTool = L.Measure.polyline(map, { layerGroup: measurementsLayerGroup });
var polygonTool =  L.Measure.polygon(map, { layerGroup: measurementsLayerGroup });

</script>

<script>
function measureCreated(params) {
  var measurer = params.measurer;
  var layer = params.layer;
  var layerType = params.layerType;
  switch (layerType) {
    case 'Marker':
      var fixedLatLng = measurer.getFixedLatLng(layer.getLatLng());
      document.getElementById('markerState').innerHTML='Создан';
      document.getElementById('markerLat').innerHTML=fixedLatLng.lat;
      document.getElementById('markerLng').innerHTML=fixedLatLng.lng;
      break;
    case 'Rectangle':
      document.getElementById('rectangleState').innerHTML='Создан';
      break;
    case 'Circle':
      document.getElementById('circleState').innerHTML='Создан';
      break;
  }
}

function measureEdit(params) {
  var measurer = params.measurer;
  var layer = params.layer;
  var layerType = params.layerType;
  switch (layerType) {
    case 'Marker':
      var fixedLatLng = measurer.getFixedLatLng(layer.getLatLng());
      document.getElementById('markerState').innerHTML='Перемещается';
      document.getElementById('markerLat').innerHTML=fixedLatLng.lat;
      document.getElementById('markerLng').innerHTML=fixedLatLng.lng;
      break;
    case 'Rectangle':
      document.getElementById('rectangleState').innerHTML='Изменяется';
      break;
    case 'Circle':
      document.getElementById('circleState').innerHTML='Изменяется';
      break;
  }
}

function measureEditend(params) {
  var measurer = params.measurer;
  var layer = params.layer;
  var layerType = params.layerType;
  switch (layerType) {
    case 'Marker':
      var fixedLatLng = measurer.getFixedLatLng(layer.getLatLng());
      document.getElementById('markerState').innerHTML='Перемещен';
      document.getElementById('markerLat').innerHTML=fixedLatLng.lat;
      document.getElementById('markerLng').innerHTML=fixedLatLng.lng;
      break;
    case 'Rectangle':
      document.getElementById('rectangleState').innerHTML='Изменен';
      break;
    case 'Circle':
      document.getElementById('circleState').innerHTML='Изменен';
      break;
  }

}

map.on('measure:created', measureCreated);
map.on('measure:edit', measureEdit);
map.on('measure:editend', measureEditend);
</script>

<button id="measureMarkerBtn" onclick="markerTool.enable();">Измерить координаты</button>
<button id="measureRectangleBtn" onclick="rectangleTool.enable();">Измерить прямоугольник</button>
<button id="measureCircleBtn" onclick="circleTool.enable();">Измерить круг</button>
<button id="measurePolilineBtn" onclick="polylineTool.enable();">Измерить ломаную</button>
<button id="measurePolygonBtn" onclick="polygonTool.enable();">Измерить многоугольник</button>


<table id='measureResult' width='100%'>
  <tr>
    <th width='100'>Объект</th>
    <th width='150'>Состояние</th>
    <th></th>
  </tr>
  <tr valign='top'>
    <th>Маркер</th>
    <td id='markerState'>&nbsp;</td>
    <td>
      <table>
        <tr>
          <th width='400'>Широта</th>
          <th width='400'>Долгота</th>
        </tr>
        <tr>
          <td id='markerLat'>&nbsp;</td>
          <td id='markerLng'>&nbsp;</td>
        </tr>
      </table>
    </td>
  </tr>

  <tr valign='top'>
    <th>Прямоугольник</th>
    <td id='rectangleState'>&nbsp;</td>
        <td>
      <table>
        <tr>
          <th width='200'>Центр</th>
          <th width='400'>Границы</th>
          <th width='100'>Ширина</th>
          <th width='100'>Высота</th>
          <th width='100'>Периметр</th>
          <th width='100'>Площадь</th>
          </tr>
        <tr>

        </tr>
      </table>
    </td>
  </tr>

  <tr valign='top'>
    <th>Круг</th>
    <td id='circleState'>&nbsp;</td>
        <td>
      <table>
        <tr>
          <th width='200'>Центр</th>
          <th width='400'>Границы</th>
          <th width='100'>Радиус</th>
          <th width='100'>Периметр</th>
          <th width='100'>Площадь</th>
          </tr>
        <tr>

        </tr>
      </table>
    </td>
  </tr>

</table>

</body>
</html>
